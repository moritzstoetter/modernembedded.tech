---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Box from "../../components/ui/Box.astro";
import {
  getLangFromUrl,
  idIsOfLanguage,
  useTranslations,
} from "../../i18n/utils";
import Base from "../../layouts/Base.astro";

const blogPosts = await getCollection("blog");
const lang = getLangFromUrl(Astro.url);

const langBlogPosts = blogPosts.filter((c) => idIsOfLanguage(c.id, lang));

const t = useTranslations(lang);

export async function getStaticPaths() {
  const pages = await getCollection("blog");

  const paths = pages.map((page) => {
    const [lang] = page.id.split("/");
    return { params: { lang }, props: page };
  });

  return paths;
}
---

<Base>
  <h1>Blog posts</h1>
  <div class="grid grid-cols-1 gap-8 mx-4 md:grid-cols-2 lg:mx-0">
    {
      langBlogPosts.map((blogPost) => (
        <Box href={`/${lang}/blog/${blogPost.slug.split("/")[1]}`} padded>
          <div class="flex flex-col gap-8">
            <Image src={blogPost.data.image} alt={blogPost.data.imageAlt} />
            <h2>{blogPost.data.title}</h2>
          </div>
        </Box>
      ))
    }
  </div>
</Base>
