---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { useTranslations } from "../../i18n/utils";
import Testimonial from "../Testimonial.astro";
import Box from "../ui/Box.astro";
import Tag from "../ui/Tag.astro";

const { lang, slug } = Astro.props;

const caseStudies = await getCollection("case-studies");
const testimonials = await getCollection("testimonials");

const caseStudy = caseStudies.find((s) => s.id === `${lang}/${slug}`)?.data;
const langTestimonials = testimonials.filter(
  (t) =>
    t.id.startsWith(lang) &&
    caseStudy?.testimonials.includes(t.data.identifier),
);

const t = useTranslations(lang);
---

{
  !!caseStudy ? (
    <section class="flex flex-col gap-8 py-8" id={caseStudy.title}>
      <div class="grid grid-cols-1 md:grid-cols-3">
        <div class="col-span-1">
          <Image src={caseStudy.image} alt={caseStudy.title} />
        </div>
        <h1 class="flex items-center justify-center col-span-2 text-primaryLight dark:text-primaryDark">
          {caseStudy.title}
        </h1>
      </div>
      <p>{caseStudy.description}</p>
      <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
        <Box padded>
          <div class="flex flex-col gap-4">
            <h2 class="text-primaryLight darK:text-primaryDark">
              {t("caseStudies.aboutTheClient")}
            </h2>
            <p>{caseStudy.about}</p>
          </div>
        </Box>
        <div class="col-span-1" />
        <Box padded>
          <div class="flex flex-col gap-4">
            <h2 class="text-primaryLight darK:text-primaryDark">
              {t("caseStudies.theChallenge")}
            </h2>
            <p>{caseStudy.challenge}</p>
          </div>
        </Box>
        <Box padded>
          <div class="flex flex-col gap-4">
            <h2 class="text-primaryLight darK:text-primaryDark">
              {t("caseStudies.deliveredValue")}
            </h2>
            <p>{caseStudy.deliveredValue}</p>
          </div>
        </Box>
      </div>
      <Box padded>
        <div class="flex flex-col gap-4">
          <h2 class="text-primaryLight darK:text-primaryDark">
            {t("caseStudies.theProduct")}
          </h2>
          <p>{caseStudy.product}</p>
        </div>
      </Box>
      <div class="flex flex-row items-center gap-4">
        <span class="text-2xl">{t("caseStudies.technologies")}</span>
        <ul class="flex flex-row gap-4">
          {caseStudy.tech.map((tech) => (
            <Tag text={tech} />
          ))}
        </ul>
      </div>
      <h2>{t("caseStudies.testimonial")}</h2>
      <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
        {langTestimonials.map((testimonial) => (
          <Testimonial testimonial={testimonial?.data} />
        ))}
      </div>
    </section>
  ) : (
    <div>
      <h1>{t("caseStudies.notFound")}</h1>
    </div>
  )
}
